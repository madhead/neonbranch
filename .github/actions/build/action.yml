name: Build
description: Build the lambda package

inputs:
  environment:
    required: false
    description: The environment to build for

runs:
  using: composite
  steps:
    - uses: docker/setup-qemu-action@v2
      with:
        platforms: 'arm64'

    # - uses: docker/setup-buildx-action@v2



    # - uses: actions/setup-python@v4
    #   with:
    #     python-version: 3.9

    # - uses: abatilo/actions-poetry@v2

    - run: echo "env = '${{ inputs.environment }}'" >> lambda/__init__.py
      if: inputs.environment != ''
      working-directory: lambda
      shell: bash

    # - run: poetry build
    #   working-directory: lambda
    #   shell: bash

    # - run: poetry run pip install --upgrade --target package dist/*.whl
    #   working-directory: lambda
    #   shell: bash

    # - run: zip -r ../neonbranch.zip . -x '*.pyc'
    #   working-directory: lambda/package
    #   shell: bash

    - run: docker-compose run builder make neonbranch.zip
      working-directory: lambda
      shell: bash
